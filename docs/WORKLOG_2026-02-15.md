# WORKLOG (2026-02-15)

## 목적
- Windows 로컬 환경에서 `Claude Code + Ollama + Cursor/OpenClaw` 운영 기반을 구축하고 검증한 작업 이력 기록.

## 완료 항목
1. Claude Code + Ollama 설치/연동
- `ollama` 버전 정상화 확인 (`0.16.1`, mismatch 경고 없음)
- 모델 준비 확인:
  - `kwangsuklee/SEOKDONG-llama3.1_korean_Q5_K_M:latest`
  - `exaone3.5:7.8b`
- Claude Code 설치 완료 (`2.1.42`)
- 연동 스모크 성공:
  - `ollama launch claude --model ... -- -p "Respond with exactly: OLLAMA_OK"`

2. 운영 보안/설정 정비
- `C:\Users\jichu\.openclaw\openclaw.json` 백업 생성
- Ollama base URL / primary / fallback 모델 값 정렬
- gateway auth token 재생성
- Telegram 토큰 재설정 및 allowlist 복원

3. 운영 런북 문서화
- `docs/CLAUDE_CODE_OLLAMA_WINDOWS_RUNBOOK.md` 추가
- `README.md` 문서 인덱스에 런북 링크 추가

4. Queue + Worker 스캐폴딩 구축
- 생성 파일:
  - `docker-compose.yml`, `.env.example`, `README_AUTODEV.md`
  - `.autodev_ssot/*` (MANIFEST, BATON_CURRENT, POLICY, AUDIT_SCHEMA)
  - `tasks/task_template.json`
  - `scripts/*` (init_queue, submit_task, gate_local, summarize_audit)
  - `openclaw_worker/*` (Dockerfile, requirements, worker, prompt)
- `scripts/init_queue.sh` 실행 완료
- 워커 컨테이너 기동 후 task claim/propose 검증

5. Gate 강화(자동 분류형)
- `scripts/gate_local.py` 추가
- `scripts/gate_local.sh`를 파이썬 게이트 엔진 호출 형태로 전환
- 검사 항목:
  - unified diff 형식
  - touched files 파싱
  - allowlist/denylist 경로 검증
  - secret 패턴 탐지
  - `git apply --check` 적용 가능성
  - 테스트 요구 시 증적 존재 여부
- 결과 파일:
  - `*.gate.json` 생성
  - `.autodev_queue/audit/events.ndjson`에 `GATE_LOCAL` append

## 검증 결과 요약
1. 설치/연동
- `claude auth login` 완료
- `claude -p "Respond with exactly: CLAUDE_OK"` 성공
- `ollama launch claude ... -p "MODEL_OK"` 성공

2. diff-only 무결성
- 실행 전/후 `git status --porcelain` 비교로 delta 0 확인(무변경)

3. 워커 산출물
- `.autodev_queue/work/T20260215-0001.patch`
- `.autodev_queue/work/T20260215-0001.report.json`

4. 게이트 분류 예시
- `PATCH_NOT_APPLICABLE` 코드로 FAIL 분류 및 감사 로그 적재 확인

## 이슈/메모
1. Docker 컨테이너 이름 충돌
- 기존 `/ollama` 컨테이너가 이미 존재하여 compose 기본 기동 실패
- 대응: 기존 healthy 컨테이너 재사용 + worker만 `--no-deps` 기동

2. 모델 기본값 불일치
- 워커 기본 `qwen2.5-coder:7b` 미설치로 `/api/generate` 404
- 대응: `.env`로 `OLLAMA_MODEL=kwangsuklee/...:latest` 고정

3. 수동 patch 검증 실수 빈발
- PowerShell에서 patch 파일 생성 시 인코딩/리다이렉션 문제로 patch 손상 사례 다수
- 대응: `git diff --output=...` 사용 및 생성 후 즉시 `git apply --check`

